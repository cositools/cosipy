

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Unit tests &mdash; cosipy __version__ = &#34;0.3.4&#34;
 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=f9fafa83"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="For developers" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            cosipy
              <img src="../_static/cosipy_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/other_examples.html">Other examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">For developers</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Unit tests</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#running-unit-tests">Running unit tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-a-test">Adding a test</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">cosipy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">For developers</a></li>
      <li class="breadcrumb-item active">Unit tests</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/dev/unit_tests.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="unit-tests">
<h1>Unit tests<a class="headerlink" href="#unit-tests" title="Link to this heading"></a></h1>
<p>An unit tests verified that a modules, a class or a method is working as expected. As opposed to integration and functional tests, they should be as specific as possible, attempting to isolate small blocks of code –i.e. one function at a time. The main goals for unit tests are:</p>
<blockquote>
<div><ul class="simple">
<li><p>Confirm that cosipy was succesfully installed.</p></li>
<li><p>Catch pull request that break previous code and prevent maintainer from merging them.</p></li>
</ul>
</div></blockquote>
<p>We are working towards having 100% unit test coverage. That means that all lines of code are run at least by one unit test. New pull request that reduce the coverge percentage should not be merge until this is remedied by adding new tests.</p>
<section id="running-unit-tests">
<h2>Running unit tests<a class="headerlink" href="#running-unit-tests" title="Link to this heading"></a></h2>
<p>Install <code class="docutils literal notranslate"><span class="pre">pytest</span></code> and <code class="docutils literal notranslate"><span class="pre">pytest-cov</span></code> with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">pytest</span> <span class="n">pytest</span><span class="o">-</span><span class="n">cov</span>
</pre></div>
</div>
<p>Go to the root folder of your local working repository, the one containing the folder <code class="docutils literal notranslate"><span class="pre">tests</span></code>. You need to clone the repository, as opposed to installing cosipy with <code class="docutils literal notranslate"><span class="pre">pip</span></code>.</p>
<p>Run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pytest</span> <span class="o">--</span><span class="n">cov</span><span class="o">=</span><span class="n">cosipy</span> <span class="o">--</span><span class="n">cov</span><span class="o">-</span><span class="n">report</span> <span class="n">term</span> <span class="o">--</span><span class="n">cov</span><span class="o">-</span><span class="n">report</span> <span class="n">html</span><span class="p">:</span><span class="n">tests</span><span class="o">/</span><span class="n">cov</span>
</pre></div>
</div>
<p>The last line of the report will tell you how many test failed (if any), how many passed, and how many warnings were generated.</p>
<p>Open <code class="docutils literal notranslate"><span class="pre">tests/cov/index.html</span></code> in a browser and check the coverage. This
is the percentage of lines that were executed during the tests. The goal is to have
a 100% coverage!</p>
</section>
<section id="adding-a-test">
<h2>Adding a test<a class="headerlink" href="#adding-a-test" title="Link to this heading"></a></h2>
<p>The pytest library automatically looks inside the <code class="docutils literal notranslate"><span class="pre">tests</span></code> folder for function starting with the word <code class="docutils literal notranslate"><span class="pre">test</span></code> inside files starting with the word <code class="docutils literal notranslate"><span class="pre">test</span></code>. Subfolder inside the <code class="docutils literal notranslate"><span class="pre">tests</span></code> folder need to contain a file called <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> (can be empty) in order to be picked up.</p>
<p>Each <code class="docutils literal notranslate"><span class="pre">test*</span></code> function constitutes a test. If they are run without any errors or exception, the pytest considers that the test was suscessful, independently of the return value. Use the builtin <code class="docutils literal notranslate"><span class="pre">asssert</span></code> keyword to compare a result to an expected value:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">cosipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">test_data</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cosipy.response</span><span class="w"> </span><span class="kn">import</span> <span class="n">FullDetectorResponse</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_get_effective_area</span><span class="p">():</span>

    <span class="n">response_path</span> <span class="o">=</span> <span class="n">test_data</span><span class="o">.</span><span class="n">path</span><span class="o">/</span><span class="s2">&quot;test_full_detector_response.h5&quot;</span>

    <span class="k">with</span> <span class="n">FullDetectorResponse</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">response_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>

        <span class="k">assert</span> <span class="n">response</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">6</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">assert</span></code> method will raise an exception if the result from the operation on the right return <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
<p>For some tests you might need a dataset. When that’s the case, add your files to the <code class="docutils literal notranslate"><span class="pre">cosipy/test_data</span></code> folder, which the tests can find by calling <code class="docutils literal notranslate"><span class="pre">cosipy.test_data.path</span></code>, as shown in the example above. Use the smallest file size possible required by your test. Remember that for an unit test you do not need a full-fledge data file. Instead, mock data and small subsets are enough to test the algorithms, even if they don’t result in realistic outputs or with good scientific quality. Full-fledge data might be needed for integration and functional test, but those will be handled separetly using data outside the cosipy respository.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="For developers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, COSI Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>